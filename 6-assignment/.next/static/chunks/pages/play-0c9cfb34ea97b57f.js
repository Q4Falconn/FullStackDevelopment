(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{7454:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/play",function(){return n(3895)}])},3895:function(e,r,n){"use strict";n.r(r),n.d(r,{__N_SSP:function(){return p},default:function(){return h}});var t=n(5893),l=n(7294),i=n(1163),s=n(9133),o=n(7858),c=n(6010),a=n(2239);function d(e){let{card:r,isBackCard:n}=e,i=(0,l.useMemo)(()=>{if(n)return"/cards/back.png";let e=e=>e.charAt(0)+e.slice(1).toLowerCase();return"NUMBERED"===r.type?"/cards/".concat(e(r.color),"_").concat(r.number,".jpg"):"WILD"===r.type?"/cards/Wild.jpg":"WILD DRAW"===r.type?"/cards/Wild_Draw_4.jpg":"SKIP"===r.type?"/cards/".concat(e(r.color),"_Skip.jpg"):"DRAW"===r.type?"/cards/".concat(e(r.color),"_Draw_2.jpg"):"REVERSE"===r.type?"RED"===r.color?"/cards/RED_Reverse.jpg":"/cards/".concat(e(r.color),"_Reverse.jpg"):""},[r,n]);return(0,t.jsx)("img",{style:{height:230,display:"inline"},src:i})}function u(e){let{type:r,card:n}=e;return"DRAW"===r?(0,t.jsx)(d,{isBackCard:!0,card:{type:"WILD"}}):n?(0,t.jsx)(d,{card:n}):null}var p=!0;function h(){var e,r,n;let p=(0,s.T)(),h=(0,i.useRouter)(),j=(0,s.C)(e=>e.lobby.currentGameId),y=(0,s.C)(e=>e.game.serverGame),x=(0,s.C)(e=>{var r;return null===(r=e.auth.user)||void 0===r?void 0:r.username});(0,l.useEffect)(()=>{j&&p((0,o.wc)({gameId:j}))},[p,j]);let f=(0,l.useMemo)(()=>{let e=null==y?void 0:y.state;if(!e)return null;try{return(0,c.a1)(e).state}catch(e){return console.error(e),null}},[null==y?void 0:y.state]),v=null==f?void 0:f.currentRound,m=null!==(e=null==f?void 0:f.players)&&void 0!==e?e:[],g=null!==(r=null==f?void 0:f.scores)&&void 0!==r?r:[],E=(0,l.useMemo)(()=>{if(f){for(let e=0;e<f.scores.length;e++)if(f.scores[e]>=f.targetScore)return e}},[f]);if((0,l.useEffect)(()=>{void 0!==E&&h.push("/game-over")},[E,h]),!j)return(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"No game selected. Go back to Setup."}),(0,t.jsx)("button",{onClick:()=>h.push("/"),children:"Go to Setup"})]});if(!y)return(0,t.jsx)("p",{children:"Loading game…"});if("WAITING"===y.status)return(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Waiting room"}),(0,t.jsxs)("p",{children:["Game: ",(0,t.jsx)("b",{children:j})]}),(0,t.jsxs)("p",{children:["Players: ",y.players.map(e=>e.username).join(", ")," (",y.players.length,"/",y.amountOfPlayers,")"]}),(0,t.jsx)("button",{onClick:()=>p((0,o.t)({gameId:j})),disabled:y.players.length<2,children:"Start game"})]});if(!v)return(0,t.jsx)("p",{children:"Game started, waiting for state…"});let _=x?m.indexOf(x):0,W=a.$m(v,_),w=v.discardPile[0],D=v.playerInTurn,R=D===_;async function C(e,r){let n;if(R&&a.tW(v,e)){if(("WILD"===r.type||"WILD DRAW"===r.type)&&!(n=function(){var e;let r=null===(e=window.prompt("Choose color: RED, GREEN, BLUE, YELLOW"))||void 0===e?void 0:e.trim().toUpperCase();if(r&&("RED"===r||"GREEN"===r||"BLUE"===r||"YELLOW"===r))return r}()))return;await p((0,o.Oq)({gameId:j,cardIndex:e,nextColor:n})).unwrap()}}return(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Play"}),(0,t.jsxs)("p",{style:{opacity:.8},children:["Game: ",(0,t.jsx)("b",{children:j})," \xb7 Current color: ",(0,t.jsx)("b",{children:v.currentColor})]}),(0,t.jsxs)("p",{children:["Turn: ",(0,t.jsx)("b",{children:null!==(n=m[null!=D?D:0])&&void 0!==n?n:"—"})," ",R?"(you)":""]}),(0,t.jsxs)("div",{style:{display:"flex",gap:20,alignItems:"center",flexWrap:"wrap"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Draw pile"}),(0,t.jsx)("div",{onClick:()=>R?p((0,o.tv)({gameId:j})):null,style:{cursor:R?"pointer":"not-allowed"},children:(0,t.jsx)(u,{type:"DRAW"})}),(0,t.jsx)("div",{style:{opacity:.7,marginTop:6},children:R?"Click to draw":"Wait your turn"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Discard pile"}),(0,t.jsx)(u,{type:"DISCARD",card:w})]})]}),(0,t.jsxs)("h3",{style:{marginTop:22},children:["Your hand (",W.length,")"]}),!R&&(0,t.jsx)("p",{style:{opacity:.7},children:"You can’t play right now."}),(0,t.jsx)("div",{className:"cardGrid",children:W.map((e,r)=>{let n=R&&a.tW(v,r);return(0,t.jsx)("div",{onClick:()=>n&&C(r,e),style:{cursor:n?"pointer":"not-allowed",opacity:n?1:.45,transform:n?"translateY(-2px)":void 0},title:n?"Play":"Cannot play",children:(0,t.jsx)(d,{card:e})},r)})}),(0,t.jsx)("h3",{style:{marginTop:24},children:"Scores"}),(0,t.jsx)("ul",{children:m.map((e,r)=>{var n;return(0,t.jsxs)("li",{children:[e,": ",null!==(n=g[r])&&void 0!==n?n:0]},e)})})]})}},1163:function(e,r,n){e.exports=n(3079)}},function(e){e.O(0,[62,888,774,179],function(){return e(e.s=7454)}),_N_E=e.O()}]);